//= require facebook_sdk
//= require_self
if(!olook) var olook = {};

olook.createFacebookUser = function(user_info){
  $.ajax({
    type: 'POST',
    contentType: 'application/json',
    url: '/join/facebook_login',
    data: JSON.stringify({ user_info: user_info}),
    dataType: 'json'
    });
}

olook.attachFBLogin = function(el) {
  $(el).click(function(e){
    e.preventDefault();

    FB.login(function(response) {
      if (response.authResponse) {
        console.log('Welcome!  Fetching your information.... ');
        FB.api('/me', function(response) {
          console.log('Good to see you, ' + response + '.');
          olook.createFacebookUser(response);
        });
      } else {
        console.log('User cancelled login or did not fully authorize.');
      }
    }, {scope: '<%= User::ALL_FACEBOOK_PERMISSIONS %>'});
  })
}

$(function(){
  olook.attachFBLogin('.fb_login_button')
})

<h2>Listing products</h2>
<%= form_tag(sync_products_admin_products_path, :id => 'sync_products') do %>
  <% if @sync_event.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sync_event.errors.count, "error") %> prohibited this event from being saved:</h2>
      <ul>
      <% @sync_event.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <%= submit_tag('Sync products', class: 'button info') %>
<% end %>

<div class="search">
  <h3>Search options:</h3>
<%= form_tag(admin_products_path, method: :get) do %>
  <%= hidden_field_tag :s, params[:s] %>
  <%= hidden_field_tag :d, params[:d] %>
  <%= search_field_tag :q, params[:q], {placeholder: 'Name or Model number'} %>
  <%= select_tag :col, grouped_options_for_select(@collections, params[:col]), {prompt: 'Collection'} %>
  <%= select_tag :cat, options_for_select(@categories, params[:cat]), {prompt: 'Category'} %>
  <%= select_tag :p, options_from_collection_for_select(@profiles, "id", "name", params[:p]), {prompt: 'Profile'} %>
  <%= button_tag 'Search', name: nil, type: 'submit', :class => 'button' %>
<% end %>
</div>

<div class="inner">
  <div class="actions-bar wat-cf">
    <div class="pagination">
      <%= will_paginate @products %>
    </div>
  </div>
  <table class="table">
    <tr>
      <th><%= sortable('name') %></th>
      <th>Model #</th>
      <th>Liquidation</th>
      <th><%= sortable('category') %></th>
      <th>Visible?</th>
      <th>Price</th>
      <th>Inventory</th>
      <th>Color</th>
      <th>Profile</th>
      <th><%= sortable('collection_id', 'Collection') %></th>
      <th style="width:100px">Picture</th>
      <th>Sample</th>
      <th></th>
    </tr>
  <% @products.each do |product| %>
    <tr class="<%= 'not-visible' if !product.is_visible %>">
      <td><%= product.name %></td>
      <td><%= product.model_number %></td>
      <td><%= LiquidationProductService.new(@liquidation, product).liquidation_name %></td>
      <td><%= product.category_humanize %></td>
      <td><%= product.is_visible? ? 'Yes' : 'No' %></td>
      <td><%= number_to_currency product.price %></td>
      <td><%= product.inventory %></td>
      <td><%= product.color_name %></td>
      <td><%= product.profiles.map(&:name).join(", ") %></td>
      <td><%= "#{product.collection.try(:name)} #{product.collection.try(:start_date).try(:year)}" %></td>
      <td><%= image_tag(product.showroom_picture, size: '100x100') if product.showroom_picture %></td>
      <td><%= image_tag(product.color_sample_url, size: '50x50') unless product.color_sample.blank? %></td>
      <td>
        <%= link_to "Preview", product_path(product), class: 'button info', target: "_blank" %>
        <%= link_to 'Show', admin_product_path(product), class: 'button' %>
        <%= link_to 'Edit', edit_admin_product_path(product), class: 'button' %>
      </td>
    </tr>
  <% end %>
  </table>
  <br />
  <div class="actions-bar wat-cf">
    <div class="pagination">
      <%= will_paginate @products %>
    </div>
  </div>
  <br class="clear" />
</div>

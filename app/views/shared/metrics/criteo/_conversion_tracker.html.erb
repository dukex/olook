<script type="text/javascript" src="/assets/criteo.js" async="true"></script>
<script type="text/javascript">
  dataLayer.push({
      'CustomerId': '<%= raw current_user.try(:id) %>',
      'orderNumber': '<%= raw order.number %>',
      'CriteoSource': '<%= raw criteo_conversion %>',
      'NewUser': '<%= raw order.user.first_buy? ? 1 : 0 %>',
      'ProductsList': ['<%= raw order.line_items.map{|p| p.variant.product_id.to_s}.join("','") %>'],
      'PriceList': ['<%= raw order.line_items.map{|p| p.retail_price.to_s}.join("','") %>'],
      'QuantityList': ['<%= raw order.line_items.map{|p| p.quantity.to_s}.join("','") %>']
      });
</script>

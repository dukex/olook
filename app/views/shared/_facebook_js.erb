<div id="fb-root"></div>
<script type="text/javascript">
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/all.js#xfbml=1&appId=<%= @facebook_app_id %>";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

</script>


<script type="text/javascript">

init_facebook = function (){
  window.fbAsyncInit = function(){
    FB.init({
      appId: '<%= facebook_app_id %>',
      status: true,
      cookie: true,
      oauth: true,
      xfbml: true,
      frictionlessRequests : true

    });

    FB.Event.subscribe('edge.create', function(href, widget) {
      _gaq.push(['_trackEvent', 'Facebook', 'Like', href]);
    });

    try {
      FB.XFBML.parse();
    } catch(ex){}

  }


  $("a.face-message").click(function(){
    if($("div.line.size ol").find("li input[type='radio']:checked").length > 0){
      FB.login(function(login_response) {
        if (login_response.authResponse) {
          getBoyfriendName();
        } else {
          console.log('User cancelled login or did not fully authorize.');
        }
      }, {scope: 'friends_birthday,publish_stream'});
    }
    else{
      showAlert();
    }
  });

  if($("#quick_view ul.social li.facebook").length > 0){
    $("#quick_view ul.social li.facebook a").click(function(){postProductToFacebookFeed()})
  }

}
window.addEventListener('load', init_facebook);



function sendFacebookMessage() {
  FB.ui({
    method: 'send',
    caption: 'www.olook.com.br',
    picture: 'cdn.olook.com.br/assets/socialmedia/facebook/icon-app/app-2012-09-19.jpg',
    <% if member %>
      description: 'Tenho uma vitrine personalizada da Olook e recebo dicas das Stylists! Responda também, descubra seu estilo e tenha uma vitrine personalizada <%= accept_invitation_url(:invite_token => member.invite_token) %> #ficaadica',
      link: 'http://olook.com.br'
    <% else %>
      description: 'Tenho uma vitrine personalizada da Olook e recebo dicas das Stylists! Responda também, descubra seu estilo e tenha uma vitrine personalizada',
      link: '<%=  root_url %>'
    <% end %>
  });
}

function postToFacebookFeed() {
  var obj = {
method: 'feed',
    caption: 'www.olook.com.br',
    picture: 'cdn.olook.com.br/assets/socialmedia/facebook/icon-app/app-2012-09-19.jpg',
    <% if member %>
        link: '<%=  accept_invitation_url(:invite_token => member.invite_token) %>',
        description: 'Tenho uma vitrine personalizada da Olook e recebo dicas das Stylists! Responda também, descubra seu estilo e tenha uma vitrine personalizada <%= accept_invitation_url(:invite_token => member.invite_token) %> #ficaadica'
    <% else %>
      link: '<%=  root_url %>',
      description: 'Tenho uma vitrine personalizada da Olook e recebo dicas das Stylists! Responda também, descubra seu estilo e tenha uma vitrine personalizada <%= root_url %> #ficaadica'

    <% end %>
  };

  FB.ui(obj);
}

<% if defined?(product) && product.present? %>

function postProductToFacebookFeed() {
  var obj = {
    method: 'feed',
    caption: 'www.olook.com.br',
    link: '<%= request.host_with_port %>/produto/<%= product.id %>',
    picture: '<%= product.catalog_picture.to_s %>',
    description: '<%= share_description(product) %>'
  };

  FB.ui(obj);
}
<% end %>

</script>

<script type="text/javascript">
var boyfriend = "";
$(function(){
	window.fbAsyncInit = function(){
  	FB.init({
	    appId: '<%= facebook_app_id %>',
	    status: true,
	    cookie: true,
	    oauth: true,
      xfbml: true,
      frictionlessRequests : true,
  
	  });
    
    FB.Event.subscribe('xfbml.render',function(){
      window.setTimeout(function(){getBoyfriendName()},1000);
    });
    
    FB.Event.subscribe('edge.create', function(href, widget) {
      _gaq.push(['_trackEvent', 'Facebook', 'Like', href]);
    });

	  try {
	    FB.XFBML.parse();
	  } catch(ex){}
    
	}
  
  
  $("a.face-message").click(function(){sendMessageToBoyfriend()})
});


function getBoyfriendName(){

  FB.api('/me', function(response) {
    significant_other = response.significant_other;
    if(significant_other){
      boyfriend = significant_other.id;
    }
    return;
  });
}


function sendMessageToBoyfriend() {
  ui_hash = {
    method: 'feed',
    caption: 'Subtitulo do texto (precisa ser alterado)',
    name: 'Titulo do texto (precisa ser alterado)',
    to: boyfriend,

    <% if member && @product %>
      description: 'Tenho uma vitrine personaliza da olook e recebo recomendações das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10! <%= valentine_link_for(member, @product) %> #ficaadica',
      link: '<%= valentine_link_for(member, @product) %>',
      picture: '<%= @product.suggestion_picture.to_s %>'
    <% else %>
      description: 'Tenho uma vitrine personaliza da olook e recebo recomendações das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10!',
      link: '<%=  root_url %>'
    <% end %>   
  }; 
  
  FB.ui(ui_hash);
}



function sendFacebookMessage() {
  FB.ui({
    method: 'send',
    caption: 'www.olook.com.br',
    picture: 'cdn.olook.com.br/assets/socialmedia/facebook/icon-app/app-2012-09-19.jpg',
    <% if member %>
      description: 'Tenho uma vitrine personaliza da olook e recebo recomendações das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10! <%= accept_invitation_url(:invite_token => member.invite_token) %> #ficaadica',
      link: 'http://olook.com.br'
    <% else %>
      description: 'Tenho uma vitrine personaliza da olook e recebo recomendações das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10!',
      link: '<%=  root_url %>'
    <% end %>   
  });
}

function postToFacebookFeed() {
  var obj = {
method: 'feed',
    caption: 'www.olook.com.br',
    picture: 'cdn.olook.com.br/assets/socialmedia/facebook/icon-app/app-2012-09-19.jpg',
    <% if member %>
        link: '<%=  accept_invitation_url(:invite_token => member.invite_token) %>',
        description: 'Tenho uma vitrine personalizada da olook e recebo recomendações incríveis das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10! <%= accept_invitation_url(:invite_token => member.invite_token) %> #ficaadica'
    <% else %>
      link: '<%=  root_url %>',
      description: 'Tenho uma vitrine personalizada da olook e recebo recomendações incríveis das Stylists! Responda o style quiz, descubra o seu estilo e ganhe R$10! <%= root_url %> #ficaadica'

    <% end %>
  };

  FB.ui(obj);
}

(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/all.js#xfbml=1&appId=<%= @facebook_app_id %>";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

</script>


$("#total_value").html("<%= number_to_currency(@cart_service.total) %>");

<% if @cart.coupon %>
  $("#coupon_discount").html("<%= number_to_currency(@cart_service.total_coupon_discount) if !@cart.coupon.is_percentage? %><%= discount_percentage(@cart.coupon.discount_percent) %>");
  $("#coupon_info").show();
<% else %>
  $("#coupon_discount").html("");
  $("#coupon_info").hide();
<% end %>

$("#coupon a#show_coupon_field").show();
$("#coupon a#show_coupon_field").siblings("form").hide();

// update overall total
$('table#total tr.total span').text('<%= number_to_currency(@cart_service.total) %>');

// update item rows discounts and subtotals
<% @cart.items.each do |item| %>
	$("table#products tbody tr#product_<%= item.product.id %> td.discount").empty();

	$("table#products tbody tr#product_<%= item.product.id %> td.discount").first().append("<%= escape_javascript( render partial: 'cart/items/discount', 
																					locals: { 
																						cart_service: @cart_service, 
																						item: item
																					} ) %>");

	$("table#products tbody tr#product_<%= item.product.id %> td.value").empty();

	$("table#products tbody tr#product_<%= item.product.id %> td.value").first().append("<%= escape_javascript( render partial: 'cart/items/subtotal', 
																						locals: { 
																							cart_service: @cart_service, 
																							item: item
																						} ) %>");
<% end %>